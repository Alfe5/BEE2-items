"Conditions"
	{
	"Condition"
		{
		"Priority" "-15"
		"instance"	"<ITEM_CUBE>"
		"Result"
			{
			"Has"
				{
				"Cube"  "1"
				}
			"_MarkLinkedCube" "instance:cube;OnUser1"
			}
		}
		
	"Condition"
		{
		"Priority" "-10"
		"instance"	"<ITEM_DROPPER_CUBE>"
		"Result"
			{
			"Has"
				{
				"CubeDropper"	"1"
				}
			"LinkedCubeDropper"
				{
				"FizzleOut" "instance:spawn_man;OnUser1"
				"RespawnIn" "voice_rl:Trigger"
				"RespawnIn" "voice_rl:FireUser1"
				}
			}
			
		// If there's empty room sufficent for a taller tube,
		// add it.
		"Condition"
			{
			"BlockType"
				{
				"Offset" "0 0 -1"
				"Type"   "VOID"
				}
			"BlockType"
				{
				"Offset" "0 0 -2"
				"Type"   "VOID"
				}
			"BlockType"
				{
				"Offset" "0 0 -3"
				"Type"   "VOID"
				}
			"Result"
				{
				// Mark as embedded, so other items don't fill the space.
				"SetBlock"
					{
					"Offset" "0 0 -1"
					"Type"   "EMBED"
					}
				"SetBlock"
					{
					"Offset" "0 0 -2"
					"Type"   "EMBED"
					}
				"SetBlock"
					{
					"Offset" "0 0 -3"
					"Type"   "EMBED"
					}
				// Remove the top brush
				"AlterTexture"
					{
					"Dir" "0 0 1"
					"Pos" "0 0 -4"
					"Tex" "<delete>"
					}
					
				// Move cubes to the top of the new dropper hole
				"SetInstVar" "$cube_off 0 0 -384"
				"AddOverlay"
					{
					"File" "<ITEM_CUBE:bee2_dropper_long_shaft>"
					}
				}
			// Blocked, use original dropper hole size.
			"Else"
				{
				"AddOverlay"
					{
					"File" "<ITEM_CUBE:bee2_dropper_short_shaft>"
					}
				"SetInstVar" "$cube_off 0 0 0"
				}
			}
			
		
		"Condition"
			{
			"instvar"	"$cube_type 0"
			"Result"
				{
				"Has"
					{
					"Cube"					"1"
					"CubeStandard"			"1"
					"CubeDropperStandard"	"1"
					}
				"addOverlay"
					{
					"File"   "<ITEM_CUBE:bee2_shaft_standard>"
					"Offset" "$cube_off"
					}
				"addOverlay"
					{
					"File"	"<ITEM_CUBE:bee2_dropper_standard>"
					}
				}
			}
		"Condition"
			{
			"instvar"	"$cube_type 1"
			"Result"
				{
				"Has"
					{
					"Cube"					"1"
					"CubeCompanion"			"1"
					"CubeDropperCompanion"	"1"
					}
				"addOverlay"
					{
					"File"   "<ITEM_CUBE:bee2_shaft_companion>"
					"Offset" "$cube_off"
					"Silent" "1"
					}
				"addOverlay"
					{
					"File"   "<ITEM_CUBE:bee2_dropper_companion>"
					"Silent" "1"
					}
				}
			}
		"Condition"
			{
			"instvar"	"$cube_type 2"
			"Result"
				{
				"Has"
					{
					"Cube"					"1"
					"CubeReflection"		"1"
					"CubeDropperReflection"	"1"
					}
				"addOverlay"
					{
					"File"   "<ITEM_CUBE:bee2_shaft_reflect>"
					"Offset" "$cube_off"
					"Silent" "1"
					}
				"addOverlay"
					{
					"File"   "<ITEM_CUBE:bee2_dropper_reflect>"
					"Silent" "1"
					}
				}
			}
		"Condition"
			{
			"instvar"	"$cube_type 3"
			"Result"
				{
				"Has"
					{
					"Cube"					"1"
					"CubeSphere"			"1"
					"CubeDropperSphere"		"1"
					}
				"addOverlay"
					{
					"File"   "<ITEM_CUBE:bee2_shaft_sphere>"
					"Offset" "$cube_off"
					"Silent" "1"
					}
				"addOverlay"
					{
					"File"   "<ITEM_CUBE:bee2_dropper_sphere>"
					"Silent" "1"
					}
				}
			}
		"Condition"
			{
			"instvar"	"$cube_type 6"
			"Result"
				{
				"Has"
					{
					"Cube"					"1"
					"CubeFranken"			"1"
					"CubeDropperFranken"	"1"
					}
				"addOverlay"
					{
					"File"   "<ITEM_CUBE:bee2_shaft_franken>"
					"Offset" "$cube_off"
					"Silent" "1"
					}
				"addOverlay"
					{
					"File"   "<ITEM_CUBE:bee2_dropper_franken>"
					"Silent" "1"
					}
				}
			}
			
		// Add some logic for voicelines
		"Condition"
			{
			"instvar" "$disable_autorespawn 0"
			"Condition"
				{
				"instvar" "cube_type 1"
				"Result"
					{
					"addOverlay"
						{
						"File"	"instances/BEE2/clean/items/cube/dropper_respawn_ccube.vmf"
						}
					}
				"Else"
					{
					"addOverlay"
						{
						"File"	"instances/BEE2/clean/items/cube/dropper_respawn.vmf"
						}
					}
				}
			"ElseCondition"
				{
				"instvar" "cube_type 1"
				"Result"
					{
					"addOverlay"
						{
						"File"	"instances/BEE2/clean/items/cube/dropper_no_respawn_ccube.vmf"
						}
					}
				"Else"
					{
					"addOverlay"
						{
						"File"	"instances/BEE2/clean/items/cube/dropper_no_respawn.vmf"
						}
					}
				}
			}
		}
		
	"Condition"
		{
		"instance"	"<ITEM_CUBE:standard>"
		"Result"
			{
			"Has"
				{
				"CubeStandard"              "1"
				"CubeDropperlessStandard"   "1"
				}
			}
		}
	"Condition"
		{
		"instance"	"<ITEM_CUBE:companion>"
		"Result"
			{
			"Has"
				{
				"Cube"                      "1"
				"CubeCompanion"             "1"
				"CubeDropperlessCompanion"  "1"
				}
			}
		}
	"Condition"
		{
		"instance"	"<ITEM_CUBE:reflection>"
		"Result"
			{
			"Has"
				{
				"Cube"                      "1"
				"CubeReflection"            "1"
				"CubeDropperlessReflection" "1"
				}
			}
		}
	"Condition"
		{
		"instance"	"<ITEM_CUBE:sphere>"
		"Result"
			{
			"Has"
				{
				"CubeSphere"            "1"
				"CubeDropperlessSphere" "1"
				}
			}
		}
	"Condition"
		{
		"instance"	"<ITEM_CUBE:franken>"
		"Result"
			{
			"Has"
				{
				"CubeFranken"               "1"
				"CubeDropperlessFranken"    "1"
				}
			}
		}
	}